#!/usr/bin/env bash

export GIT_PS1_SHOWDIRTYSTATE="true"
export GIT_PS1_STATESEPARATOR="|"
export GIT_PS1_SHOWSTASHSTATE="true"
export GIT_PS1_SHOWUNTRACKEDFILES="true"
export GIT_PS1_COMPRESSSPARSESTATE="true"

export PROMPT_DIRTRIM="3"

_previous_status() {
  if [[ ${?} -eq 0 ]]; then
    printf -- "%bâœ”%b" "${GREEN}" "${RESET}"
  else
    printf -- "%bx%b" "${RED}" "${RESET}"
  fi
}

PS1_TEMPLATE="${BLUE}\u${RESET}@${RED}\h${RESET} ${GREEN}\w${RESET}"
if command -v git >/dev/null 2>&1 && [[ "$(type -t __git_ps1)" == "function" ]]; then
  PS1_TEMPLATE+="${YELLOW}\$(__git_ps1)${RESET}"
fi

if command -v kubectl >/dev/null 2>&1 && [[ "$(type -t __kube_ps1)" == "function" ]]; then
  PS1_TEMPLATE+="${BLUE}\$(__kube_ps1)${RESET}"
fi

PS1_TEMPLATE+=" \$(_previous_status)\n> "

_prompt_command() {
  # Adding time padded to the right, from https://superuser.com/a/1203400
  PS1="\[\e[s\e[${COLUMNS:-$(tput cols)}C\e[5D\A\e[u\]${PS1_TEMPLATE}"
}

export PROMPT_COMMAND='_prompt_command'
