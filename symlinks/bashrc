#!/usr/bin/env bash

[[ -z ${PS1:-} ]] && return

set_locale() {
  local LOCALES=("en_US.UTF-8" "en_US.utf8" "C.UTF-8" "C")
  local ALL_LOCALES
  ALL_LOCALES="$(locale -a)"

  for locale in "${LOCALES[@]}"; do
    if [[ $(echo "${ALL_LOCALES}" | grep -c "${locale}") -eq 1 ]]; then
      export LC_ALL="${locale}"
      export LANG="${locale}"
      export LANGUAGE="${locale}"

      return
    fi
  done

  return 1
}

source_all() {
  local BASHRC_PATH
  BASHRC_PATH="$(python -c 'import sys; import os.path; print(os.path.realpath(sys.argv[1]))' "${BASH_SOURCE[0]}")"
  local DOTFILES_PATH
  DOTFILES_PATH="$(dirname "${BASHRC_PATH}")"

  local LC_ALL="C"
  local LANG="C"

  if [[ -e "${DOTFILES_PATH}/../scripts/meta" ]]; then
    source "${DOTFILES_PATH}/../scripts/meta" && meta_init "var" "git" "github" "version" "ssh" "tmux"
    var_color
  fi

  shopt -s nullglob
  for file in "${DOTFILES_PATH}/../sources/"*; do
    [[ -r ${file} ]] && [[ -f ${file} ]] && source "${file}"
  done
  shopt -u nullglob
}

set_locale
source_all

if [[ -e "${HOME}/.localrc" ]]; then
  source "${HOME}/.localrc"
fi

unset -f set_locale
unset -f source_all
